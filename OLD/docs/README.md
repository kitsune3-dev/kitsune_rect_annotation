矩形アノテーションツール
===
## 概要

矩形アノテーションツールは、解説書などの文書をスキャンした画像から、章タイトル、節タイトル、本文などの構成要素を矩形で囲んでマークアップするためのブラウザベースのツールです。マークアップされたデータはJSON形式で保存され、後続の処理で利用できます。

### 主な機能

- モード選択: 矩形追加、矩形削除、矩形番号振り直しモードの切り替え
- 矩形種別選択: 9種類の矩形種別（章タイトル、節タイトル、概要、本文、補足、コラム、用語解説、図、表）から選択可能
- 矩形領域選択: マウスで画像上の領域を矩形で選択
- 矩形の削除: 不要な矩形を選択して削除
- 矩形番号の振り直し: 矩形に割り当てられたIDを再割当
- Undo/Redo機能: 操作の取り消しと再実行
- 保存機能: アノテーションデータをJSON形式でダウンロード
- 画像操作機能: 拡大・縮小、移動表示

## 使い方

### 1. ツールの起動

annotation.html、annotation.css、annotation.jsの3つのファイルを同じディレクトリに配置  
同じディレクトリに「test.png」という名前でアノテーション対象の画像を配置  
Webブラウザでannotation.htmlを開く  

### 2. 基本操作

#### モード選択
- 「矩形追加」「矩形削除」「矩形番号振り直し」の3つのモードから選択

#### 矩形の追加（矩形追加モード）
- サイドバーから矩形種別（章タイトル、節タイトル、など）を選択  
- 画像上でマウスをクリックして始点を指定  
- そのままドラッグするか、別の位置でクリックして終点を指定
- 選択した領域が半透明の矩形で表示される

#### 矩形の削除（矩形削除モード）
- 削除したい矩形をクリックして選択
- 選択された矩形は赤い枠線で強調表示される
- 複数の矩形を選択可能
- 「削除」ボタンをクリックして選択した矩形を削除
- 「キャンセル」ボタンをクリックして削除操作をキャンセル

#### 矩形番号の振り直し（矩形番号振り直しモード）
- 番号を割り当てたい順番に矩形をクリックしていく
- 選択された矩形は緑の枠線で強調表示され、中央にID番号が表示される
- 「OK」ボタンをクリックして番号振り直しを確定
  - すべての矩形が選択されていない場合は警告が表示される
- 「未選択矩形を強調表示」ボタンをクリックすると、まだ選択されていない矩形が点滅表示される
- 「キャンセル」ボタンをクリックして番号振り直し操作をキャンセル

#### 画像の操作
- 拡大・縮小:
    - 画面右下のズームコントロール（+/-/⟳）をクリック
    - または画像領域でマウスホイールをスクロール
- 水平移動表示:
    - Macの場合：commandキーを押しながらドラッグ
    - Windowsの場合：Ctrlキーを押しながらドラッグ

#### 操作の取り消しと再実行
- Undo: 「Undo」ボタンをクリック、または Cmd+Z / Ctrl+Z
- Redo: 「Redo」ボタンをクリック、または Cmd+Shift+Z / Ctrl+Shift+Z、または Cmd+Y / Ctrl+Y

#### データの保存
- 「保存」ボタンをクリック、または Cmd+S / Ctrl+S
- annotation.jsonという名前でJSONファイルがダウンロードされる

#### キーボードショートカット
- Undo: Cmd+Z / Ctrl+Z
- Redo: Cmd+Shift+Z / Ctrl+Y
- 保存: Cmd+S / Ctrl+S
- 画像移動モード: Cmdキー / Ctrlキーを押している間

### 3. 操作上の注意点

- 矩形選択中は、別の矩形種別を選択することはできません
- 矩形の最小サイズは5x5ピクセル以上である必要があります
- 画像を移動した後でも正確に矩形選択ができます（座標は画像の原点に対する相対座標で記録されます）
- 矩形は重なりがないことを前提としています（レイヤー等の概念はありません）

## 保存データについて

保存されるJSONデータの形式は以下の通りです：

```json
{
  "image": "test.png",
  "labels": {
    "1": "章タイトル",
    "2": "節タイトル",
    "3": "概要",
    "4": "本文",
    "5": "補足",
    "6": "コラム",
    "7": "用語解説",
    "8": "図",
    "9": "表"
  },
  "annotation": [
    {
      "id": 1,
      "label_id": 1,
      "polygon": [100, 50, 300, 50, 300, 100, 100, 100]
    },
    ...
  ]
}
```

スキーマ

|キー|説明|
|--|--|
|image|アノテーション対象の画像ファイル名|
|labels|ラベルIDとラベル名の対応表|
|annotation|矩形領域のリスト|
|id|矩形のID（連番）|
|label_id|矩形の種別を示すラベルID|
|polygon|矩形の4つの頂点の座標 <br>[左上x, 左上y, 右上x, 右上y, 右下x, 右下y, 左下x, 左下y]|

## トラブルシューティング
- 画像が読み込まれない
    - test.pngが適切なディレクトリに配置されていることを確認
    - ブラウザのコンソールでエラーメッセージを確認
- 操作がうまくいかない
    - ブラウザをリロードして再試行
    - ブラウザの開発者ツールを開いてエラーメッセージを確認
- 保存したJSONが正しくない
    - ブラウザの開発者ツールでコンソールログを確認
    - 保存前に表示される座標情報をチェック

## 制限事項
- 現在のバージョンでは、画像ファイル名は「test.png」に固定されています
- 矩形のみのアノテーションに対応しており、多角形やフリーハンドには対応していません
- 矩形領域は重なりがないことを前提としています（レイヤー等の概念はありません）