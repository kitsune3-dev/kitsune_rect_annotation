# 矩形アノテーションツール テスト仕様書

## テスト環境

- **テストフレームワーク**: Playwright  
- **ブラウザ**: Chromium, Firefox, Safari  
- **動作環境**: ヘッドレスモード / GUIモード 両対応  

---

## 自動化テスト項目

### 1. 初期表示テスト

| テストID  | テスト内容                           | 検証方法                        | 自動化  |
|-----------|----------------------------------|------------------------------|-------|
| UI-001    | アプリケーションの初期表示確認           | ページ読み込み後のDOM構造を検証       | 完全自動化 |
| UI-002    | `test.png` の読み込み確認       | `canvas` 要素内に画像が表示されているか確認 | 完全自動化 |
| UI-003    | 初期状態での各ボタンの有効/無効状態確認    | `Undo/Redo` ボタンが無効、`保存` ボタンが有効であることを確認 | 完全自動化 |
| UI-004    | 初期選択ラベルの確認                  | `章タイトル` が選択されていることを確認   | 完全自動化 |

### 2. 矩形選択機能テスト

| テストID    | テスト内容                          | 検証方法                                      | 自動化 |
|------------|--------------------------------|------------------------------------------|------|
| RECT-001   | クリックによる矩形選択(始点)          | `canvas` 上のクリックイベント発火と状態変更を検証 | 完全自動化 |
| RECT-002   | クリックによる矩形選択(終点)          | 2回目のクリックで矩形が確定することを検証           | 自動化(スクリーンショット比較) |
| RECT-003   | ドラッグによる矩形選択               | `mousedown → mousemove → mouseup` の一連の動作で矩形が生成されるか確認 | 自動化(スクリーンショット比較) |
| RECT-004   | 小さすぎる矩形は作成されないことを確認 | `5px×5px` 未満の矩形が生成されないことを検証 | 完全自動化 |
| RECT-005   | 矩形選択時のステータス表示更新        | 選択状態の変化に応じたステータスメッセージ更新を確認 | 完全自動化 |
| RECT-006   | 複数矩形の作成                    | 連続して複数の矩形を作成できることを確認         | 自動化(スクリーンショット比較) |

### 3. ラベル選択機能テスト

| テストID    | テスト内容                          | 検証方法                        | 自動化 |
|------------|--------------------------------|------------------------------|------|
| LABEL-001  | 各ラベルボタンのクリック              | 各ラベルボタンをクリックし、選択状態が変わることを確認 | 完全自動化 |
| LABEL-002  | 矩形選択中はラベル変更不可の確認      | 矩形選択中にラベルボタンをクリックしても変更されないことを確認 | 完全自動化 |
| LABEL-003  | 異なるラベルでの矩形作成          | 各ラベルで矩形を作成し、色が適切に反映されるか確認 | 自動化(スクリーンショット比較) |

### 4. Undo/Redo機能テスト

| テストID     | テスト内容                        | 検証方法                     | 自動化  |
|-------------|--------------------------------|-------------------------|------|
| HISTORY-001 | Undoボタンのクリック            | 矩形作成後に `Undo` をクリックし、矩形が削除されることを確認 | 自動化(スクリーンショット比較) |
| HISTORY-002 | Redoボタンのクリック            | `Undo` 後に `Redo` をクリックし、矩形が復元されることを確認 | 自動化(スクリーンショット比較) |
| HISTORY-003 | キーボードショートカット(Undo)     | `Cmd+Z` / `Ctrl+Z` で `Undo` 操作が行われることを確認 | 完全自動化 |
| HISTORY-004 | キーボードショートカット(Redo)     | `Cmd+Shift+Z` / `Ctrl+Y` で `Redo` 操作が行われることを確認 | 完全自動化 |
| HISTORY-005 | 履歴の上限テスト                | 多数の操作を行った後も正しく `Undo/Redo` ができることを確認 | 自動化(スクリーンショット比較) |

### 5. 画像操作機能テスト

| テストID   | テスト内容                      | 検証方法                     | 自動化  |
|-----------|------------------------------|-------------------------|------|
| ZOOM-001  | 拡大ボタンのクリック           | `拡大ボタン` をクリックし、画像が拡大されることを確認 | 自動化(スクリーンショット比較) |
| ZOOM-002  | 縮小ボタンのクリック           | `縮小ボタン` をクリックし、画像が縮小されることを確認 | 自動化(スクリーンショット比較) |
| ZOOM-003  | リセットボタンのクリック       | `リセットボタン` をクリックし、表示が初期状態に戻ることを確認 | 自動化(スクリーンショット比較) |
| PAN-001   | 画像のドラッグ移動              | `Cmd/Ctrl` キーを押しながらドラッグで画像が移動することを確認 | 自動化(スクリーンショット比較) |

### 6. 保存機能テスト

| テストID  | テスト内容                     | 検証方法                     | 自動化  |
|----------|-----------------------------|-------------------------|------|
| SAVE-001 | 保存ボタンのクリック         | `保存ボタン` をクリックしてダウンロードが開始されることを確認 | 完全自動化 |
| SAVE-002 | キーボードショートカット(保存) | `Cmd+S` / `Ctrl+S` で `保存` 操作が行われることを確認 | 完全自動化 |

---

## スクリーンショット比較テスト自動化

### ベースラインスクリーンショット取得
- 正常動作時のスクリーンショットを事前に記録  
- 各テストケースごとに期待される状態のスクリーンショットを保存  

### テスト実行時のスクリーンショット比較
1. テスト開始  
2. 初期状態のスクリーンショット  
3. テストアクション実行  
4. アクション後のスクリーンショット  
5. `pixelmatch` などのライブラリでベースラインと比較  
6. 差分結果に基づいて合否判定  

### レポート生成
- テスト実行結果の概要（合格/失敗数）  
- 失敗したテストの詳細（スクリーンショット差分を含む）  
- パフォーマンスメトリクス（実行時間、メモリ使用量など）  
- ブラウザごとの互換性チェック結果  

---

## 注意事項

- スクリーンショット比較テストは環境によって結果が微妙に異なるため、適切な許容範囲を設定すること  
- CIで実行する場合は、ヘッドレスモードでの画像の読み込みに関する制約に注意すること  
- 大規模なE2Eテストを実行する前に、単体テストとして各機能の小さなテストから確認すること  
